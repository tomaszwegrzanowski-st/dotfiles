#!/usr/bin/env ruby

require "pathname"

paths = ARGV.map{ Pathname(_1) }

# This is useful to deal with CSVs generated by the overseer
# They're UTF-16 and that works poorly with existing tools
paths.each do |path|
  # utf16 bom le and be
  if path.binread(2) == "\xFF\xFE".b
    # puts "utf16"
    content = path.binread.force_encoding("utf-16le").encode("utf-8")
    path.binwrite(content)
  elsif path.binread(2) == "\xFE\xFF".b
    # puts "utf16"
    content = path.binread.force_encoding("utf-16be").encode("utf-8")
    path.binwrite(content)
  else
    # puts "utf8"
  end
end
